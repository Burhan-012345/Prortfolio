{% extends "admin/base.html" %} {% block title %}Manage Blog Posts{% endblock %}
{% block page_title %}Blog Posts Management{% endblock %} {% block content %}
<div class="admin-header-actions">
  <a href="{{ url_for('new_blog_post') }}" class="btn btn-primary">
    <i class="fas fa-plus"></i> New Blog Post
  </a>

  <div class="header-stats">
    <span class="stat"> <strong>{{ posts|length }}</strong> total posts </span>
    <span class="stat">
      <strong>{{ posts|selectattr('published')|list|length }}</strong> published
    </span>
    <span class="stat">
      <strong>{{ posts|selectattr('published', 'false')|list|length }}</strong>
      drafts
    </span>
  </div>
</div>

<div class="admin-filters">
  <div class="filter-tabs">
    <button class="filter-tab active" data-filter="all">All Posts</button>
    <button class="filter-tab" data-filter="published">Published</button>
    <button class="filter-tab" data-filter="drafts">Drafts</button>
  </div>

  <div class="search-box">
    <input
      type="text"
      id="blog-search"
      placeholder="Search posts..."
      class="form-control"
    />
    <i class="fas fa-search"></i>
  </div>
</div>

<div class="table-container">
  <table class="admin-table" id="blog-posts-table">
    <thead>
      <tr>
        <th>Title</th>
        <th>Author</th>
        <th>Status</th>
        <th>Views</th>
        <th>Created</th>
        <th>Last Updated</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for post in posts %}
      <tr
        class="post-row"
        data-status="{{ 'published' if post.published else 'draft' }}"
      >
        <td>
          <div class="post-title-cell">
            <strong>{{ post.title }}</strong>
            <div class="post-slug">{{ post.slug }}</div>
            {% if post.tags %}
            <div class="post-tags">
              {% for tag in post.tags.split(',')[:3] %}
              <span class="tag small">{{ tag.strip() }}</span>
              {% endfor %} {% if post.tags.split(',')|length > 3 %}
              <span class="tag small"
                >+{{ post.tags.split(',')|length - 3 }}</span
              >
              {% endif %}
            </div>
            {% endif %}
          </div>
        </td>
        <td>{{ post.author.username }}</td>
        <td>
          {% if post.published %}
          <span class="badge badge-success">
            <i class="fas fa-check-circle"></i> Published
          </span>
          {% else %}
          <span class="badge"> <i class="fas fa-edit"></i> Draft </span>
          {% endif %}
        </td>
        <td>
          <div class="views-cell">
            <span class="views-count">{{ post.views }}</span>
            <small>views</small>
          </div>
        </td>
        <td>{{ post.created_at.strftime('%Y-%m-%d') }}</td>
        <td>{{ post.updated_at.strftime('%Y-%m-%d') }}</td>
        <td class="actions">
          <div class="action-buttons">
            <a
              href="{{ url_for('blog_post', slug=post.slug) }}"
              class="btn btn-small btn-outline"
              target="_blank"
              title="View"
            >
              <i class="fas fa-eye"></i>
            </a>

            <a
              href="{{ url_for('edit_blog_post', post_id=post.id) }}"
              class="btn btn-small"
              title="Edit"
            >
              <i class="fas fa-edit"></i>
            </a>

            {% if post.published %}
            <form
              action="{{ url_for('unpublish_blog_post', post_id=post.id) }}"
              method="POST"
              class="inline-form"
            >
              <button
                type="submit"
                class="btn btn-small btn-warning"
                title="Unpublish"
              >
                <i class="fas fa-eye-slash"></i>
              </button>
            </form>
            {% else %}
            <form
              action="{{ url_for('publish_blog_post', post_id=post.id) }}"
              method="POST"
              class="inline-form"
            >
              <button
                type="submit"
                class="btn btn-small btn-success"
                title="Publish"
              >
                <i class="fas fa-paper-plane"></i>
              </button>
            </form>
            {% endif %}

            <form
              action="{{ url_for('delete_blog_post', post_id=post.id) }}"
              method="POST"
              class="inline-form"
            >
              <button
                type="submit"
                class="btn btn-small btn-danger"
                onclick="return confirm('Delete this blog post?')"
                title="Delete"
              >
                <i class="fas fa-trash"></i>
              </button>
            </form>
          </div>
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="7" class="no-data">
          <div class="empty-state">
            <i class="fas fa-blog"></i>
            <h3>No blog posts yet</h3>
            <p>Create your first blog post to start sharing your knowledge.</p>
            <a href="{{ url_for('new_blog_post') }}" class="btn btn-primary">
              <i class="fas fa-plus"></i> Create First Post
            </a>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Bulk Actions -->
<div class="bulk-actions">
  <select id="bulk-action" class="form-control">
    <option value="">Bulk Actions</option>
    <option value="publish">Publish Selected</option>
    <option value="unpublish">Unpublish Selected</option>
    <option value="delete">Delete Selected</option>
  </select>
  <button id="apply-bulk-action" class="btn btn-outline">Apply</button>
</div>
{% endblock %} {% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Filter tabs
    const filterTabs = document.querySelectorAll(".filter-tab");
    const postRows = document.querySelectorAll(".post-row");

    filterTabs.forEach((tab) => {
      tab.addEventListener("click", function () {
        const filter = this.dataset.filter;

        // Update active tab
        filterTabs.forEach((t) => t.classList.remove("active"));
        this.classList.add("active");

        // Filter rows
        postRows.forEach((row) => {
          if (filter === "all" || row.dataset.status === filter) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        });
      });
    });

    // Search functionality
    const searchInput = document.getElementById("blog-search");
    searchInput.addEventListener("input", function () {
      const searchTerm = this.value.toLowerCase();

      postRows.forEach((row) => {
        const title = row.querySelector("strong").textContent.toLowerCase();
        const slug = row.querySelector(".post-slug").textContent.toLowerCase();
        const tags =
          row.querySelector(".post-tags")?.textContent.toLowerCase() || "";

        if (
          title.includes(searchTerm) ||
          slug.includes(searchTerm) ||
          tags.includes(searchTerm)
        ) {
          row.style.display = "";
        } else {
          row.style.display = "none";
        }
      });
    });

    // Bulk actions
    const bulkAction = document.getElementById("bulk-action");
    const applyBulkAction = document.getElementById("apply-bulk-action");

    applyBulkAction.addEventListener("click", function () {
      const action = bulkAction.value;
      if (!action) return;

      // Implementation for bulk actions would go here
      alert(`Bulk action "${action}" would be implemented in production`);
    });
  });
</script>

<style>
  .admin-filters {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    gap: 1rem;
  }

  .filter-tabs {
    display: flex;
    gap: 0.5rem;
  }

  .filter-tab {
    padding: 0.5rem 1rem;
    background: var(--bg-glass);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--border-radius);
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .filter-tab:hover,
  .filter-tab.active {
    background: var(--accent-primary);
    color: #000;
    border-color: var(--accent-primary);
  }

  .search-box {
    position: relative;
    width: 300px;
  }

  .search-box input {
    padding-left: 2.5rem;
  }

  .search-box i {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-secondary);
  }

  .post-title-cell strong {
    display: block;
    margin-bottom: 0.25rem;
  }

  .post-slug {
    font-size: 0.8rem;
    color: var(--text-secondary);
    font-family: monospace;
    margin-bottom: 0.5rem;
  }

  .post-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
  }

  .tag.small {
    font-size: 0.7rem;
    padding: 0.2rem 0.5rem;
  }

  .views-cell {
    text-align: center;
  }

  .views-count {
    font-weight: bold;
    font-size: 1.1rem;
    display: block;
  }

  .views-cell small {
    font-size: 0.8rem;
    color: var(--text-secondary);
  }

  .action-buttons {
    display: flex;
    gap: 0.25rem;
    flex-wrap: wrap;
  }

  .bulk-actions {
    display: flex;
    gap: 0.5rem;
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
  }

  .bulk-actions select {
    width: 200px;
  }

  .empty-state {
    text-align: center;
    padding: 3rem;
    color: var(--text-secondary);
  }

  .empty-state i {
    font-size: 3rem;
    margin-bottom: 1rem;
    color: var(--accent-primary);
  }

  .empty-state h3 {
    margin-bottom: 0.5rem;
    color: var(--text-primary);
  }

  .header-stats {
    display: flex;
    gap: 1.5rem;
  }

  .stat {
    color: var(--text-secondary);
  }

  .stat strong {
    color: var(--text-primary);
  }

  @media (max-width: 768px) {
    .admin-filters {
      flex-direction: column;
      align-items: stretch;
    }

    .filter-tabs {
      justify-content: center;
    }

    .search-box {
      width: 100%;
    }

    .header-stats {
      justify-content: center;
    }

    .action-buttons {
      flex-direction: column;
    }
  }
</style>
{% endblock %}
