{% extends "admin/base.html" %} {% block title %}Contact Messages{% endblock %}
{% block page_title %}Contact Messages{% endblock %} {% block content %}
<div class="messages-container">
  <div class="messages-header">
    <h2>All Contact Messages</h2>
    <div class="messages-stats">
      <span class="stat">{{ messages|length }} total messages</span>
      <span class="stat unread"
        >{{ messages|selectattr('read', 'false')|list|length }} unread</span
      >
    </div>
  </div>

  <div class="messages-list">
    {% for message in messages %}
    <div class="message-item {% if not message.read %}unread{% endif %}">
      <div class="message-header">
        <div class="message-sender">
          <strong>{{ message.name }}</strong>
          <span class="message-email">&lt;{{ message.email }}&gt;</span>
        </div>
        <div class="message-meta">
          <span class="message-date"
            >{{ message.created_at.strftime('%Y-%m-%d %H:%M') }}</span
          >
          <span class="message-ip">{{ message.ip_address }}</span>
          {% if not message.read %}
          <span class="badge badge-new">NEW</span>
          {% endif %}
        </div>
      </div>

      <div class="message-subject">
        <strong>{{ message.subject }}</strong>
      </div>

      <div class="message-preview">
        {{ message.message[:150] }}{% if message.message|length > 150 %}...{%
        endif %}
      </div>

      <div class="message-actions">
        <a
          href="{{ url_for('view_message', message_id=message.id) }}"
          class="btn btn-small"
        >
          <i class="fas fa-eye"></i> View Details
        </a>
        {% if not message.read %}
        <form
          action="{{ url_for('mark_message_read', message_id=message.id) }}"
          method="POST"
          class="inline-form"
        >
          <button type="submit" class="btn btn-small btn-success">
            <i class="fas fa-check"></i> Mark Read
          </button>
        </form>
        {% endif %}
        <form
          action="{{ url_for('delete_message', message_id=message.id) }}"
          method="POST"
          class="inline-form"
        >
          <button
            type="submit"
            class="btn btn-small btn-danger"
            onclick="return confirm('Delete this message?')"
          >
            <i class="fas fa-trash"></i> Delete
          </button>
        </form>
      </div>
    </div>
    {% else %}
    <div class="no-messages">
      <i class="fas fa-inbox"></i>
      <h3>No messages yet</h3>
      <p>
        Contact messages will appear here when users submit the contact form.
      </p>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
